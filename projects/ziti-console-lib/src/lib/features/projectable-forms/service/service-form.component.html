<div class="projectable-form-wrapper"
     (keyup.enter)="save($event)"
     (keyup.escape)="closeModal(false)"
>
    <lib-form-header
        [data]="formData"
        [title]="(formData.id ? 'EditService' : 'CreateService') | translate"
        [moreActions]="formData.moreActions"
        (actionRequested)="headerActionRequested($event)"
        [(formView)]="formView"
    ></lib-form-header>
    <div class="edge-router-form-container projectable-form-container">
        <div class="projectable-form-main-column form-group-row" *ngIf="formView === 'simple'">
            <div class="form-group-column three-fifths">
                <lib-form-field-container [title]="'ServiceName' | translate" [label]="'Required' | translate">
                    <input
                        class="form-field-input"
                        placeholder="{{'ServiceNamePlaceholder' | translate}}"
                        [ngClass]="{error: errors['name']}"
                        [(ngModel)]="formData.name"
                        autofocus
                        #nameFieldInput
                    />
                </lib-form-field-container>
                <lib-form-field-container
                        [title]="'ServiceAttributesTitle' | translate"
                        [label]="'Optional' | translate"
                        [contentStyle]="'z-index: 99999999'"
                        [helpText]="'ServiceAttributesHelp' | translate"
                >
                    <lib-tag-selector
                            [(selectedRoleAttributes)]="formData.roleAttributes"
                            [availableRoleAttributes]="serviceRoleAttributes"
                            [placeholder]="'ServiceAttributesPlaceholder' | translate"
                    ></lib-tag-selector>
                </lib-form-field-container>
                <ng-content select="[slot=provider]"></ng-content>
                <lib-form-field-toggle [(toggleOn)]="showMore" style="margin: 0px 10px"></lib-form-field-toggle>
                <div *ngIf="showMore" class="form-group-column">
                    <lib-form-field-container
                        [title]="'TerminatorStrategy' | translate"
                        [title2]="'Encryption' | translate"
                        [layout]="'row'"
                        class="form-field-advanced"
                    >
                        <select
                                [(ngModel)]="formData.terminatorStrategy"
                                id="authPolicyId"
                                class="form-field-dropdown"
                        >
                            <option value="">{{'SelectStrategy' | translate}}</option>
                            <option
                                    *ngFor="let strat of strategies"
                                    [value]="strat.id"
                            >
                                {{ strat.label }}
                            </option>
                        </select>
                        <div class="config-item">
                            <div class="config-container toggle-container">
                                <div class="config-container-label">{{'RequireEncryption' | translate}}</div>
                                <div
                                        (click)="toggleEncryptionRequired()"
                                        [ngClass]="{ on: formData.encryptionRequired }"
                                        class="toggle"
                                >
                                    <span [hidden]="!formData.encryptionRequired" class="on-label">YES</span>
                                    <span [hidden]="formData.encryptionRequired" class="off-label">NO</span>
                                    <div class="switch"></div>
                                </div>
                            </div>
                        </div>
                    </lib-form-field-container>
                    <lib-form-field-container
                            [title]="'Custom Tags'"
                            [label]="'OPTIONAL'"
                            class="form-field-advanced"
                    >
                        <lib-custom-tags [(tags)]="formData.tags"></lib-custom-tags>
                    </lib-form-field-container>
                    <lib-form-field-container
                            [title]="'App Data'"
                            [label]="'OPTIONAL'"
                            class="form-field-advanced"
                    >
                        <lib-json-view></lib-json-view>
                    </lib-form-field-container>
                </div>
            </div>
            <div class="form-group-column two-fifths">
                <lib-form-field-container
                        [title]="'AddConfigurations' | translate"
                >
                    <div class="form-field-input-group">
                        <span class="form-field-title">{{'SelectAConfig' | translate}}</span>
                        <select
                                [(ngModel)]="selectedConfigTypeId"
                                (change)="configTypeChanged($event)"
                                id="SelectedConfigType"
                                class="form-field-dropdown"
                        >
                            <option value="">{{'SelectConfigurationType' | translate}}</option>
                            <option
                                    *ngFor="let type of configTypes"
                                    [value]="type.id"
                            >
                                {{ type.name }}
                            </option>
                        </select>
                        <select
                                [(ngModel)]="selectedConfigId"
                                (change)="configChanged($event)"
                                id="SelectedConfig"
                                class="form-field-dropdown"
                                [ngClass]="{'disabled': !selectedConfigTypeId || selectedConfigTypeId === ''}"
                        >
                            <option value="">{{'SelectConfiguration' | translate}}</option>
                            <option value="add-new">{{'AddNew' | translate}} Config</option>
                            <option
                                    *ngFor="let config of filteredConfigs"
                                    [value]="config.id"
                            >
                                {{ config.name }}
                            </option>
                        </select>
                        <div *ngIf="showConfigData">
                            <span class="form-field-title" style="margin-bottom: 10px;">{{'ConfigName' | translate}}</span>
                            <input
                                    [(ngModel)]="newConfigName"
                                    class="form-field-input"
                                    [placeholder]="'NewConfigName' | translate"
                                    [ngClass]="{error: configErrors['configName']}"
                            />
                        </div>
                    </div>

                    <div *ngIf="showConfigData" class="form-field-input-group">
                        <span class="form-field-title">{{'JSONConfiguration' | translate}}</span>
                        <lib-json-view [(data)]="configData"></lib-json-view>
                    </div>
                    <div class="button-row-right" *ngIf="showAttachButton">
                        <div
                            class="save-button"
                            (click)="attachConfig(selectedConfigId)"
                        >{{'AttachService' | translate}}
                        </div>
                    </div>
                </lib-form-field-container>
                <lib-form-field-container
                    [title]="'SelectedConfigurations' | translate"
                    [count]="formData.configs ? formData.configs.length : 0"
                >
                    <lib-preview-list
                        [allNames]="addedConfigNames"
                    ></lib-preview-list>
                </lib-form-field-container>
                <lib-form-field-container
                        *ngIf="formData.id"
                        [title]="'Associated Services'"
                        [count]="associatedIdentities.length"
                        [class]="'hide-overflow'"
                        [helpText]="'Preview list of all identities that this Service is associated with.'"
                >
                    <lib-preview-list
                        [clickable]="false"
                        [isLoading]="identitiesLoading"
                        [allNames]="associatedIdentities"
                    ></lib-preview-list>
                </lib-form-field-container>
                <lib-form-field-container
                        [title]="'API Calls'"
                        [label]="'OPTIONAL'"
                >
                    <div class="form-row">
                        <input class="form-field-input" [value]="apiCallURL"/>
                        <div class="icon-copy copy" (click)="copyToClipboard(apiCallURL)"></div>
                    </div>
                    <lib-json-view *ngIf="formData" [(data)]="apiData" [readOnly]="true" [showCopy]="true"></lib-json-view>
                </lib-form-field-container>
            </div>
        </div>
        <div class="form-group-column" *ngIf="formView === 'raw'">
            <lib-json-view *ngIf="formData" [(data)]="formData"></lib-json-view>
        </div>
    </div>
</div>
<lib-loading-indicator *ngIf="isLoading" [isLoading]="isLoading"></lib-loading-indicator>